<style>
    /*样式写这里*/

    .disk-format{
        border-radius: 10%;
        padding: 2px;
    }
    .demo-table table tbody tr td span{
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        max-width:300px;
        display:block;
    }

    .plugin_body .table {
        border: 1px solid #ddd;
        color: #666;
        font-size: 12px;
        margin-bottom: 0;
    }
    .plugin_body .table thead th{
        vertical-align: inherit;
        background-color: #f6f6f6;
        border-bottom: 1px solid #e6e6e6;
        color: #666;
        font-weight: normal;
        padding: 8px;
    }
    #iplist input{
        border: 1px solid #ccc;
        padding: 7px 0px;
        border-radius: 3px;
        padding-left:5px;
        -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
        box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
        -webkit-transition: border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;
        -o-transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
        transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s
    }
    #iplist input:focus{
        border-color: #66afe9;
        outline: 0;
        -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);
        box-shadow: inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6)
    }
    .disabled{
        pointer-events: none;
        color: #666666;
    }

    @keyframes square{0%{opacity:.5;transform:translatey(0) rotate(45deg)}
    25%{opacity:.75;transform:translatey(-400px) rotate(90deg)}
    50%{opacity:1;transform:translatey(-600px) rotate(135deg)}
    to{opacity:0;transform:translatey(-1000px) rotate(180deg)}
    }
    @-webkit-keyframes square{0%{opacity:.5;-webkit-transform:translatey(0) rotate(45deg)}
    25%{opacity:.75;-webkit-transform:translatey(-400px) rotate(90deg)}
    50%{opacity:1;-webkit-transform:translatey(-600px) rotate(135deg)}
    to{opacity:0;-webkit-transform:translatey(-1000px) rotate(180deg)}
    }
    @-webkit-keyframes removeLeft{0%{visibility:visible;-webkit-transform:translateX(0);transform:translateX(0)}
    to{-webkit-transform:translateX(-350px);transform:translateX(-350px)}
    }
    @keyframes removeLeft{0%{visibility:visible;-webkit-transform:translateX(0);transform:translateX(0)}
    to{-webkit-transform:translateX(-350px);transform:translateX(-350px)}
    }
    @-webkit-keyframes removeRight{0%{opacity:0;-webkit-transform:translateX(0);transform:translateX(0)}
    to{opacity:1;-webkit-transform:translateX(500px);transform:translateX(500px)}
    }
    @keyframes removeRight{0%{opacity:0;-webkit-transform:translateX(0);transform:translateX(0)}
    to{opacity:1;-webkit-transform:translateX(500px);transform:translateX(500px)}
    }
    @-webkit-keyframes slideInLeft{0%{visibility:visible;-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}
    to{-webkit-transform:translateZ(0);transform:translateZ(0)}
    }
    @keyframes slideInLeft{0%{visibility:visible;-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}
    to{-webkit-transform:translateZ(0);transform:translateZ(0)}
    }
    @-webkit-keyframes slideInRight{0%{visibility:visible;-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}
    to{-webkit-transform:translateZ(0);transform:translateZ(0)}
    }
    @keyframes slideInRight{0%{visibility:visible;-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}
    to{-webkit-transform:translateZ(0);transform:translateZ(0)}
    }
    .clear_header{position:relative;padding:15px 25px;height:75pt;border-bottom:1px solid #ececec;background:hsla(0,0%,100%,.74)}
    .clear_header .clear_plan{position:absolute;top:0;left:0;width:0;height:100%;background:rgba(32,165,58,.1);transition:.5s all}
    .clear_header .icon{float:left;width:60px;height:60px;border-radius:100%}
    .clear_header .icon img{width:100%}
    .clear_conter{overflow:auto;height:350px;transition:.5s all}
    .clear_conter.active{display:none}
    .clear_conter::-webkit-scrollbar{width:9pt;height:9pt;background-color:#f5f5f5}
    .clear_conter::-webkit-scrollbar-track{border-radius:2px;background-color:#f5f5f5;-webkit-box-shadow:inset 0 0 6px rgba(84,84,84,.3)}
    .clear_conter::-webkit-scrollbar-thumb{border-radius:2px;background-color:rgba(84,84,84,.8);-webkit-box-shadow:inset 0 0 6px rgba(84,84,84,.2)}
    .clear_tips{margin-left:50px;height:70px}
    .clear_tips .clear_title{float:left;margin-top:9pt;margin-left:25px;font-size:20px}
    .clear_size{margin:0 5px;color:#20a53a}
    .clear_tips .clear_opt_size{margin:0 5px;color:#fb7d00}
    .clear_tips .clear_title .clean_tips{color:#7b7b7b;font-size:14px}
    .clear_tips .clear_describe{float:right}
    .clear_tips .clear_describe a.active{border:#ececec;background:#c5c5c5ec;cursor:not-allowed}
    .clear_tips .clear_describe a.active:hover{border-color:#ececec;background-color:#c5c5c5ec}
    .clear_tips .clear_describe a{display:block;margin-top:15px;margin-left:5pc;padding:8px 25px;border:1px solid #20a53a;border-radius:42px;background:#20a53a;color:#fff;text-decoration:none;font-size:1pc;transition:.5s all}
    .clear_tips .clear_describe a:hover{border-color:#398439;background-color:#398439}
    .clerar_list .clerar_list_title{position:relative;padding-left:25px;height:50px;border-bottom:1px solid #ececec;background:hsla(0,0%,100%,.9);font-size:15px;line-height:50px}
    .clerar_list .clerar_list_title:hover{background-color:hsla(0,0%,95%,.9);cursor:pointer}
    .clerar_list .clerar_list_conter .select,.clerar_list .clerar_list_title .select{position:relative;float:left;display:block;margin:18px 10px 0 0;width:15px;height:15px;border:1px solid #cecece;border-radius:3px;cursor:pointer;transition:all .5s}
    .clerar_list .clerar_list_conter .select.active:after,.clerar_list .clerar_list_title .select.active:after{position:absolute;top:0;margin:3px;width:7px;height:7px;border-radius:2px;background:#20a53a;content:'';transition:all .5s}
    .clerar_list .clerar_list_title>span{float:left;display:block;margin-right:15px}
    .clerar_list .clerar_list_left{font-size:14px;color:#666}
    .clerar_list .clerar_list_left span{margin-left: 10px;color: #fb7d00;}
    .clerar_list .clerar_list_left i{margin:0 2px;font-style:initial;font-size:13px}
    .clerar_list_title .pull_down{position:absolute;top:19px;right:50px;display:block;width:13px;height:13px;border-right:1.5px solid #20a53a;border-bottom:1.5px solid #20a53a;cursor:pointer;transition:all .5s;transform:rotate(45deg)}
    .clerar_list_title .pull_down.active{transform:rotate(225deg)}
    .clerar_list .clerar_list_conter{margin-bottom:0;background:#fff;transition:all .5s}
    .clerar_list_conter span{height:40px}
    .clerar_list .clerar_list_conter .select{margin:9pt 9pt 0 0;width:15px;height:15px}
    .clerar_list .clerar_list_conter dd{padding-left:40px;height:40px;border-bottom:1px solid #ececec;font-size:13px;line-height:40px}
    .clerar_list .clerar_list_conter dd a,.clerar_list .clerar_list_conter dd i{margin:0 5px;margin-right:15px}
    .clerar_list .clerar_list_conter dd a{max-width:150px}
    .clerar_list .clerar_list_conter dd i{font-style:initial}



</style>
<div class="bt-form">
    <div class="bt-w-main">
        <!--菜单部分-->
        <div class="bt-w-menu">
            <p class="bgw" onclick="demo.get_index()">操作配置</p>
            <p onclick="demo.get_logs()">操作日志</p>

        </div>
        <!--内容部分-->
        <div class="bt-w-con pd15">
            <div class="plugin_body"></div>
        </div>
    </div>
</div>
<!--JS脚本部分，不要将JS脚本写在其它地方-->
<script type="text/javascript">

    //定义窗口尺寸
    $('.layui-layer-page').css({ 'width': '900px' });

    //左测菜单切换效果
    $(".bt-w-menu p").click(function () {
        $(this).addClass('bgw').siblings().removeClass('bgw')
    });


    $(".plugin_body").off("click",'.mybtn').on("click",'.mybtn',function (e) {
        if($(this).parent().parent().children().eq(1)[0].children.length==1){
            var path=$(this).parent().parent().children().eq(2)[0].children[0].value
        }else {
            var path=$(this).parent().parent().children().eq(2)[0].innerText
        }
        var format=$(this).parent().parent().children().eq(1).children().val();
        if (format==undefined){
            var format=$(this).parent().parent().children().eq(1)[0].innerText;
        }
        var handle=$(this)[0].innerText;
        var name=$(this).parent().parent().children().eq(0)[0].innerText;
        console.log(path);
        // console.log(handle);

        var rdata="path="+path+'&handel='+handle+"&addr="+name+'&formats='+format;
        $.post('/plugin?action=a&name=disk&s=CheckFilename',rdata,function(data){
                if(data.status){
                    bt.show_confirm(handle+'磁盘','您真的要'+handle+name+"磁盘吗？" +"<p class='f15' style='color: red'>"+data.msg+"</p>", function () {
                        var loadT = layer.msg('正在修改中请稍等...',{icon:16,time:5*1000});
                        $.post('/plugin?action=a&name=disk&s=MountFile',rdata,function(data){
                            layer.msg(data.msg,{icon:data.status?1:5,time:2000});
                            if(data.status){
                                layer.close(loadT);
                                if(data.hasOwnProperty("copyfile")){
                                        var loadT = layer.msg('<div class="depSpeed">正在提交..</div>',{icon:16,time:0,shade: [0.3, "#000"]});
                                        setTimeout(function(){
                                           GetSpeed(path);
                                        },2000);

                                }else {
                                    setTimeout(demo.get_index,2000)

                                }
                            }
                        });

                    });

                }else {
                    layer.msg(data.msg, { icon: 2 });
                }

        });

    });

    $(".plugin_body").off("click",'.cleanbtn').on("click",'.cleanbtn',function (e) {
        var path=$(this).parent().parent().children().eq(2)[0].innerText;
        var getinfo = layer.msg('<div>正在获取日志列表...</div>',{icon:16,time:0,shade: [0.3, "#000"]});
        // console.log("thisis ",path);
        rdata="path="+path;
        $.post('/plugin?action=a&name=disk&s=search_log',rdata,function(cdata){
            demo.clear_data = cdata;
            layer.close(getinfo);
            if (cdata['system_log'].length==0){
                    layer.msg("服务器暂无日志垃圾，请稍后重试", { icon:6});
            }else{
                var LogNum = cdata['system_log'] != undefined ? cdata['system_log'].length : 0;
                // console.log("num "+LogNum)
                rhtml="<div class=\"clear_header\">\n" +
                    "        <div class=\"icon\"><img src=\"/static/img/soft_ico/ico-clear.png\"  alt=\"\" /></div>\n" +
                    "        <div class=\"clear_tips\">\n" +
                    "            <div class=\"clear_title\"  style=\"margin-top: 20px;\">共<span class=\"clear_size\">0 B</span>可清理,已选中<span class=\"clear_opt_size\">0 B</span></div>\n" +
                    "            <div class=\"clear_describe\"><a href=\"javascript:;\" class=\"clear_key active\">正在扫描 ...</a></div>\n" +
                    "        </div>\n" +
                    "        <div class=\"clear_plan\"></div>\n" +
                    "</div>\n" +
                    "<div class=\"clear_conter active\">\n" +
                    "    <div class=\"clerar_list\" id=\"system_conter\">\n" +
                    "        <div class=\"clerar_list_title\"><i class=\"select\"></i><span>系统日志</span><div class=\"clerar_list_left\">共<i class=\"clear_session_num\">--</i>条数据，大小为<i class=\"clear_session_size\">--</i><span>(若您没有使用压缩文件，可放心清理)</span></div><i class=\"pull_down\"></i></div>\n" +
                    "        <dl class=\"clerar_list_conter\"></dl>\n" +
                    "    </div>\n" +
                    "</div>";
                bt.open({
				type: 1,
				shift: 5,
				offset: '20%',
				closeBtn: 2,
				area: '700px',
				title: ''+'简单清理日志及压缩文档',
                content: rhtml.replace('"javascript/text"', '"text/javascript"')
                });
                // demo.event();
                $('.clerar_list .clerar_list_title').unbind().click(function(e){
                    e.preventDefault();
                    e.stopPropagation();
                    if($(this).find('.pull_down').hasClass('active')){
                        $(this).find('.pull_down').removeClass('active');
                        $(this).parent().find('.clerar_list_conter').hide();
                        $(this).removeAttr('style')
                    }else{
                        $(this).find('.pull_down').addClass('active');
                        $(this).parent().find('.clerar_list_conter').show();
                        $(this).css('background','rgba(247, 247, 247, 0.69)');
                    }
            });
                $('.clerar_list .clerar_list_title .select').unbind().click(function(e){
                        e.preventDefault();
                        e.stopPropagation();
                        if($(this).hasClass('active')){
                            $(this).removeClass('active');
                            $(this).parent().parent().find('.clerar_list_conter .select').removeClass('active');
                        }else{
                           $(this).addClass('active');
                           $(this).parent().parent().find('.clerar_list_conter .select').addClass('active');
                        }
                         demo.get_opt_files();
                });
                $('.clerar_list .clerar_list_conter').unbind().on('click','.select',function(e){
                e.preventDefault();
                e.stopPropagation();
                if($(this).hasClass('active')){
                    $(this).removeClass('active');
                }else{
                   $(this).addClass('active');
                }
                if($(this).parent().parent().find('.select').length == $(this).parent().parent().find('.active').length){
                    $(this).parent().parent().parent().find('.clerar_list_title .select').addClass('active');
                }else if($(this).parent().parent().find('.active').length == 0){
                    $(this).parent().parent().parent().find('.clerar_list_title .select').removeClass('active');
                }
                demo.get_opt_files();
            });
                $('.clear_describe .clear_key').unbind().click(function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    if($('.select.active').length == 0){
                        layer.msg('未选择清理项？');
                        return;
                    }
                    demo.del_retuen_file();
                });
                $('.clear_btn .btn_two').unbind().click(function(e) {
                layer.closeAll();
                e.preventDefault();
                e.stopPropagation();
            });

                $('.clear_describe .clear_key').removeClass('active').html('立即清理');
                $('.clear_conter').removeClass('active');
                var system_conter = '',system_size = 0;
                for(var i=0;i<cdata['system_log'].length;i++){
                    // console.log(cdata['system_log'][i]);
                    system_conter += '<dd><i class="select" data-index="'+ i +'" data-type="system_log" data-size="'+ cdata['system_log'][i].size +'"></i><span>文件目录:<a href="javascript:;" class="btlink" title="'+ cdata['system_log'][i].path +'">'+ cdata['system_log'][i].path +'</a></span><span>文件大小:<i data-size="'+ cdata['system_log'][i].size +'">'+ toSize(cdata['system_log'][i].size) +'</i></span></dd>';
                    system_size += parseInt(cdata['system_log'][i].size);
                }
                var numAll = system_size;
                $('.clear_header .clear_title .clear_size').html(toSize(numAll));
                $('#system_conter .clerar_list_conter').html(system_conter);
                $('#system_conter .clear_session_num').html(LogNum);
                $('#system_conter .clear_session_size').html(toSize(system_size));




            }
            });

    });

    

    /**
     * 插件交互对象
     * 您的所有JS代码可以写在里面
     * 若不习惯JS的面向对象编程，可删除此对象，使用传统函数化的方式编写
     * */
    var demo = {
        clear_data:{},
        opt_data:{},
        //构造概览内容
        event:function () {
            console.log("执行了");
            var _this = this;

        },

        Changemount:function (sts) {
          console.log($(this).val());
          console.log($(this).parents())
        },
        check_filename:function (name) {

            var reg=/^\w{1,8}$/;
            return  reg.test(name);

        },
        check_china_name:function (name) {
            // var reg=/(\/)[^\1]{0,}\1/;#匹配至少出现两个
            var reg=/[\u4E00-\u9FA5]{1,7}/g;
            return reg.test(name)
        },
        del_retuen_file:function(){
            var _this = this;
            var confirm = layer.confirm('是否清理选中的日志垃圾?', {title:'警告',btn: ['确定','取消'],icon:0,closeBtn:2},
            function(){
                layer.close(confirm);
                var loadT = layer.msg('<div>正在删除...</div>',{icon:16,time:0,shade: [0.3, "#000"]});
                $(' .clear_tips .clear_describe a').hide();
                $(' .clear_tips .clear_title').append('<div class="clean_tips">正在清除日志中...</div>').css('marginTop','12px');
                $('.clerar_list .clerar_list_conter,.clerar_list .clerar_list_title .select').unbind();
                $.post('/plugin?action=a&name=disk&s=remove_file',{data: JSON.stringify(_this.opt_data)},function(res){
                    _this.clear_data = res;
                    setTimeout(function(){
						if(res.stuats === false){
                        	layer.msg(res.msg,{icon:2});
							return false;
						}
                        $('.step_three').show().prev().hide();
                        var msg = layer.msg('<div>清理完成，释放空间'+'<span class="clear_size">'+res+'</span></div>',{icon:1,time:3000,shade: [0.3, "#000"]});
                        setTimeout(function () {
                            layer.closeAll();
                        },2000);

                    }, 1000);

                });

            }, function(){
                layer.close(confirm);
            });
        },

        get_status_bar:function(callback){
            $.post('/plugin?action=a&name=disk&s=GetToStatus',function(res){
                if(callback) callback(res);
            });
        },
        get_task:function () {
            $.get('/plugin?action=a&name=disk&s=check_task',function(data){
                    if(data.status){
                        var loadT = layer.msg('<div class="depSpeed">正在提交..</div>',{icon:16,time:0,shade: [0.3, "#000"]});
                        setTimeout(function(){
                           GetSpeed('/www');
                        },2000);

                    }
            })
        },
        get_opt_files:function(){
            var _this = this,num = 0,opt = {},clerar_list = $('.clerar_list .clerar_list_conter .select'),clerar_index = '',clerar_type = '';
            opt = objDeepCopy(demo.clear_data);
            if(!$('#session_conter i').hasClass('active')){ opt.php_session = {} }
            for(var i = clerar_list.length-1; i>=0; i--){
                if(clerar_list.eq(i).hasClass('active')){ num += parseInt(clerar_list.eq(i).attr('data-size')) }
                if(!clerar_list.eq(i).hasClass('active') && clerar_list.eq(i).hasClass('select')){
                    clerar_index = parseInt(clerar_list.eq(i).attr('data-index'));
                    clerar_type = clerar_list.eq(i).attr('data-type');
                    if(clerar_type == 'Redir'){
                        opt['Recycle']['Redir'].splice(clerar_index,1);
                    }else if(clerar_type == 'Refile'){
                        opt['Recycle']['Refile'].splice(clerar_index,1);
                    }else{
                        console.log(clerar_type)
                        opt[clerar_type].splice(clerar_index,1);

                    }
                }
            }
            _this.opt_data  = opt;
            if($('#session_conter .select').hasClass('active')){
                num += parseInt($('#session_conter .select').attr('data-size'));
            }
            $('.clear_tips .clear_opt_size').html(toSize(num));


        },
        get_index: function () {

            var title='<div class="top"><ul class="help-info-text c7 mtb15 f15"><li>注意：如果需要将宝塔数据迁移至新硬盘，可以在新硬盘处填写挂载名称/www</li><li>挂载至/www时，会自动重启面板，web服务暂停使用</li><li>问题及建议反馈QQ群：<a target="_blank" href="//shang.qq.com/wpa/qunwpa?idkey=9fcc5bdc38903edd7db3219943eba6e44ab05337c4c32a8a6fc5dff5c8008046"><img border="0" src="//pub.idqqimg.com/wpa/images/group.png" alt="插件维护群" title="插件维护群">:163078943</a></li></ul></div>'
            $('.plugin_body').html("<table class=\"table table-hover\" style=\"margin-top: 10px; max-height: 300px; overflow: auto;\">\n" +
                "<thead>\n" +
                "<tr>\n" +
                "<th>硬盘地址</th>\n" +
                "<th>硬盘格式</th>\n" +
                "<th>挂载地址(如:/mydata)</th>\n" +
                "<th>清理磁盘</th>"+
                "<th>已使用/总容量</th>"+
                "<th>状态</th>\n" +
                "<th style=\"text-align: right;\">操作</th>\n" +
                "</tr>\n" +
                "</thead>\n" +
                "<tbody id=\"iplist\"></tbody>\n" +
                "</table>"+title);

            var loadT = layer.msg('<div>正在获取分区表...</div>',{icon:16,time:0,shade: [0.3, "#000"]});
            $.get('/plugin?action=a&name=disk&s=get_info',function(data){
                layer.close(loadT);
               var tbody="";

                for(var i=0;i<data.length;i++){
                    if (data[i].status==0){
                        var sss="已挂载";
                        var ttt="卸载";
                        var inp=data[i].name;
                        var clean_btn='<a href="#" style="color: green" class="btlink cleanbtn">清理</a>';
                        var sec=data[i].disk_format;
                    }else {
                        var sss='<span style="color:red">未挂载</span>';
                        var ttt="挂载";
                        var inp='<input type="text" placeholder="请输入挂载名" value="">';
                        var clean_btn='未使用';
                        var sec='<select class="disk-format"><option value="ext4">ext4</option> <option value="xfs">xfs</option></select>'

                    }
                    if(demo.check_china_name(data[i].name)){
                        var ppp='<a href="#" class="btlink mybtn disabled" >'
                    }else {
                        var ppp='<a href="#" class="btlink mybtn " >'
                    }

                    tbody += '<tr>' +
                                '<td>'+data[i].path+'</td>' +
                                '<td>'+sec+'</td>' +
                                '<td>'+inp+'</td>' +
                                '<td>'+clean_btn+'</td>' +
                                '<td>'+data[i].size+'</td>' +
                                '<td>'+ sss+'</td>' +
                                '<td style="text-align: right;">'+ppp+ttt+'</a></td>' +
                            '</tr>';
			}
			    $("#iplist").html(tbody);

            })
        },
        
        clean_log:function () {
            var confirm = layer.confirm('清除日志列表，是否继续？', {
                    title: '提示', btn:['确定', '取消'], icon: 0, closeBtn: 2
                }, function(){
                    $.post('/plugin?action=a&name=disk&s=del_log',function (rdata) {
                        layer.msg(rdata.msg,{icon:1});
                    })
                demo.get_logs()
                });
        },

        /**
         * 获取面板日志
         * @param p 被获取的分页
         */
        get_logs : function (p) {
            if (p == undefined) p = 1;
            request_plugin('disk', 'get_logs', { p: p, callback: 'demo.get_logs' }, function (rdata) {
                var log_body = '';
                console.log(rdata.data.length)
                if(rdata.data.length == 0){
                    log_body='<tr><td colspan="2">当前日志为空</td></tr>';
                    var clean_btn='<button disabled=disabled class="btn btn-success btn-sm va0 pull-right" id="del_logs_event" style="margin-bottom:10px;" onclick="demo.clean_log()">清理日志</button>'
                }else{
                    for (var i = 0; i < rdata.data.length; i++) {
                    log_body += '<tr><td>' + rdata.data[i].addtime + '</td><td><span title="' + rdata.data[i].log + '">' + rdata.data[i].log + '</span></td></tr>'
                    }
                    var clean_btn='<button class="btn btn-success btn-sm va0 pull-right" id="del_logs_event" style="margin-bottom:10px;" onclick="demo.clean_log()">清理日志</button>'
                }


                var my_body = '<div class="demo-table"><div class="divtable">'
                        +clean_btn
                            +'<table class="table table-hover">'
                                +'<thead>'
                                    +'<tr><th width="150">时间</th><th>详情</th></tr>'
                                +'</thead>'
                                +'<tbody>'+ log_body + '</tbody>'
                            +'</table>'
                    + '</div><div class="page" style="margin-top:15px">' + rdata.page + '</div</div>';

                $('.plugin_body').html(my_body);
            });
        }

    };

    function GetSpeed(path) {
        if(!$('.depSpeed')) return;
            var data="path="+path;
            $.get('/plugin?action=a&name=disk&s=GetSpeed',data,function(speed){
                if(speed.status === false){
                    var isok=layer.msg(speed.msg, {icon: 6})
                    demo.get_index()
                    return;
                }
                if(speed.name == '正在迁移文件'){
				speed = '<p>'+speed.name+' <img src="/static/img/ing.gif"></p>\
				<div class="bt-progress"><div class="bt-progress-bar" style="width:'+speed.pre+'%"><span class="bt-progress-text">'+speed.pre+'%</span></div></div>\
				<p class="f12 c9"><span class="pull-left">'+ToSize(speed.used)+'/'+ToSize(speed.total)+'</span><span class="pull-right">'+'</span></p>';
				$('.depSpeed').prev().hide();
				$('.depSpeed').css({"margin-left":"-37px","width":"380px"});
				$('.depSpeed').parents(".layui-layer").css({"margin-left":"-100px"});
                }else{
                    speed = '<p>'+speed.name+'</p>';
                    $('.depSpeed').prev().show();
                    $('.depSpeed').removeAttr("style");
                    $('.depSpeed').parents(".layui-layer").css({"margin-left":"0"});
                }

                $('.depSpeed').html(speed);
                setTimeout(function(){
                    GetSpeed(path);
                },1000);
            });
    }
    function toSize(num) {
		var d = [' B', ' KB', ' MB', ' GB', ' TB', ' PB'];
		var e = 1024;
		for (var b = 0; b < d.length; b++) {
			if (num < e) {
				return (b == 0 ? num : num.toFixed(2)) + d[b];
			}
			num /= e;
        }
	}
    function objDeepCopy(source) {
        var sourceCopy = source instanceof Array ? [] : {};
        for (var item in source) {
            sourceCopy[item] = typeof source[item] === 'object' ? objDeepCopy(source[item]) : source[item];
        }
        return sourceCopy;
    }
    /**
     * 发送请求到插件
     * 注意：除非你知道如何自己构造正确访问插件的ajax，否则建议您使用此方法与后端进行通信
     * @param plugin_name    插件名称 如：demo
     * @param function_name  要访问的方法名，如：get_logs
     * @param args           传到插件方法中的参数 请传入数组，示例：{p:1,rows:10,callback:"demo.get_logs"}
     * @param callback       请传入处理函数，响应内容将传入到第一个参数中
     */
    function request_plugin(plugin_name, function_name, args, callback, timeout) {
        if (!timeout) timeout = 3600;
        $.ajax({
            type:'POST',
            url: '/plugin?action=a&s=' + function_name + '&name=' + plugin_name,
            data: args,
            timeout:timeout,
            success: function(rdata) {
                if (!callback) {
                    layer.msg(rdata.msg, { icon: rdata.status ? 1 : 2 });
                    return;
                }
                return callback(rdata);
            },
            error: function(ex) {
                if (!callback) {
                    layer.msg('请求过程发现错误!', { icon: 2 });
                    return;
                }
                return callback(ex);
            }
        });
    }
    demo.get_task()
    //第一次打开窗口时调用
    demo.get_index();
    demo.event()
</script>